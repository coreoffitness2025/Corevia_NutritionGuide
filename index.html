<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ê²€ìƒ‰ì—”ì§„ ë…¸ì¶œì„ ë§‰ìœ¼ë ¤ë©´ -->
  <meta name="robots" content="noindex, nofollow">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Core of Fitness - ê°„í¸ ì¹¼ë¡œë¦¬ ê³„ì‚°ê¸° (3ë‹¨ê³„)</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      line-height: 1.6;
    }
    .brand-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .brand-header img {
      max-width: 300px;
      margin-bottom: 8px;
    }
    label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    .result {
      margin-top: 24px;
      padding: 16px;
      background: #f4f4f4;
      border-radius: 8px;
    }
    h2, h3 {
      margin-top: 0;
    }
    ul {
      margin-top: 0;
      padding-left: 20px;
    }
    .notice {
      margin-top: 20px;
      font-size: 13px;
      color: #666;
    }
    .example-meal {
      margin-top: 20px;
      padding: 16px;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .example-meal p {
      margin: 6px 0;
    }
    .macro-highlight {
      margin-top: 10px;
      padding: 10px;
      border: 2px solid #aaa;
      border-radius: 6px;
      background: #fff;
      display: inline-block;
    }
    .macro-highlight span {
      display: inline-block;
      margin-right: 12px;
      font-weight: bold;
    }
    .spacer {
      margin-top: 20px;
    }
    /* ë¼ë‹ˆë³„ ì‹ë‹¨ ë¸”ë¡ */
    .meal-block {
      margin-top: 20px;
      padding: 16px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .meal-block h4 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <!-- ë¡œê³  & íƒ€ì´í‹€ -->
  <div class="brand-header">
    <img src="Core of Fitness.png" alt="Core of Fitness">
    <h1>Core of Fitness ì¹¼ë¡œë¦¬ ê³„ì‚°ê¸°</h1>
  </div>

  <!-- ì…ë ¥ ì„¹ì…˜ -->
  <label>ì„±ë³„:
    <select id="gender">
      <option value="male">ë‚¨ì„±</option>
      <option value="female">ì—¬ì„±</option>
    </select>
  </label>

  <label>ë‚˜ì´ (ì„¸):
    <input type="number" id="age" placeholder="ì˜ˆ: 30">
  </label>

  <label>ì‹ ì¥ (cm):
    <input type="number" id="height" placeholder="ì˜ˆ: 170">
  </label>

  <label>ì²´ì¤‘ (kg):
    <input type="number" id="weight" placeholder="ì˜ˆ: 65">
  </label>

  <label>í™œë™ì§€ìˆ˜:
    <select id="activity">
      <option value="1.2">ìš´ë™ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ (ê±°ì˜ ì¢Œì‹, ìš´ë™X)</option>
      <option value="1.375">ë³´í†µì´ë‹¤ (ì£¼1~3íšŒ ìš´ë™)</option>
      <option value="1.55">ë§ë‹¤ (ì£¼3~5íšŒ ìš´ë™)</option>
      <option value="1.725">ì•„ì£¼ ë§ë‹¤ (ì£¼6~7íšŒ ìš´ë™)</option>
    </select>
  </label>

  <label>ëª©ì :
    <select id="goal">
      <option value="gain">ì¦ëŸ‰</option>
      <option value="loss">ê°ëŸ‰</option>
    </select>
  </label>

  <!-- (NEW) ì œì™¸í•  ì‹í’ˆ (ë©€í‹° ì…€ë ‰íŠ¸) -->
  <label>ì œì™¸í•  ì‹í’ˆ (ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥):
    <select id="excludedFoods" multiple style="height:120px;">
      <!-- ë‚˜ì¤‘ì— JSë¡œ ì˜µì…˜ì„ ì±„ì›Œë„£ê±°ë‚˜, ì§ì ‘ ì…ë ¥ ê°€ëŠ¥ -->
    </select>
  </label>

  <button onclick="calculate()">ğŸ”¥ ê³„ì‚°í•˜ê¸°</button>

  <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
  <div class="result" id="result"></div>

  <div class="notice">
    â€» ë³¸ ê³„ì‚°ê¸°ëŠ” ì˜ˆì‹œìš©ì…ë‹ˆë‹¤. ê°œì¸ë³„ ê±´ê°• ìƒíƒœë‚˜ ëª©í‘œì— ë”°ë¼ ì‹¤ì œ ì„­ì·¨ ê³„íšì€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.<br>
    â€» ë³¸ ê³„ì‚°ê¸°ëŠ” Harris-Benedict ê³µì‹ìœ¼ë¡œ ì‚°ì¶œëœ ì¹¼ë¡œë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, í•œêµ­ì¸ì— ë§ì¶° 15% ë‚®ì¶° ê³„ì‚°í•˜ì˜€ìŠµë‹ˆë‹¤.<br>
    â€» ì‹¤ì œ ì‹ë‹¨ì„ ìœ ì§€í•´ë³´ë©° 2~4ì£¼ê°„ ì²´ì¤‘ ë³€í™” ì¶”ì„¸ë¥¼ í™•ì¸ í›„, ì¡°ê¸ˆì”© ë³´ì •í•˜ì—¬ ë³¸ì¸ì˜ ìœ ì§€ ì¹¼ë¡œë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.<br>
    â€» ë‹¨ë°±ì§ˆ ë³´ì¶©ì œ(1ìŠ¤ì¿±=30g ë‹¨ë°±ì§ˆ)ë¥¼ í•˜ë£¨ì— í•œ ë²ˆ ê°„ì‹ìœ¼ë¡œ ì„­ì·¨í–ˆë‹¤ê³  ê°€ì •í•˜ê³ , ë‚˜ë¨¸ì§€ ì‹ë‹¨ êµ¬ì„±ëŸ‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤.<br>
    â€» í•˜ë£¨ 3ë¼ë¡œ ë¶„ë¦¬í•´ì„œ ì‹ë‹¨ ì˜ˆì‹œë¥¼ ë³´ì—¬ì£¼ë©°, ì œì™¸ ì‹í’ˆì´ ìˆìœ¼ë©´ ëœë¤ ì¡°í•©ì—ì„œ ë°°ì œí•©ë‹ˆë‹¤.<br>
  </div>

  <script>
    // (A) ì‹ì¬ë£Œ DB
    const PROTEIN_SOURCES = [
      { name: "ë¼ì§€ ë’·ë‹¤ë¦¬ì‚´", protein: 21, carbs: 0,   fat: 8 },
      { name: "ë¼ì§€ ì•ˆì‹¬",     protein: 22, carbs: 0,   fat: 5 },
      { name: "ë‹­ê°€ìŠ´ì‚´",     protein: 23, carbs: 0,   fat: 2 },
      { name: "ë‹­ì•ˆì‹¬",       protein: 22, carbs: 0,   fat: 2 },
      { name: "ì†Œê³ ê¸° ìš°ë‘”ì‚´", protein: 21, carbs: 0,   fat: 6 },
      { name: "ì—°ì–´",         protein: 20, carbs: 0,   fat: 13 },
      { name: "ë¬´ì§€ë°© ê·¸ë¦­ìš”ê±°íŠ¸", protein: 10, carbs: 4, fat: 0 },
      { name: "ê³„ë€",         protein: 12, carbs: 1,   fat: 10 }
    ];

    const CARB_SOURCES = [
      { name: "í˜„ë¯¸ë°¥",     protein: 3,  carbs: 35, fat: 1 },
      { name: "í†µë°€ ë² ì´ê¸€", protein: 10, carbs: 45, fat: 1 },
      { name: "í†µë°€ íŒŒìŠ¤íƒ€", protein: 14, carbs: 70, fat: 2 },
      { name: "ì˜¤íŠ¸ë°€",      protein: 13, carbs: 66, fat: 7 },
      { name: "ê³ êµ¬ë§ˆ",      protein: 1.5, carbs: 30, fat: 0.1 },
      { name: "ê°ì",        protein: 2,   carbs: 20, fat: 0.1 }
    ];

    const FAT_SOURCES = [
      { name: "ë•…ì½©ë²„í„°",  protein: 25, carbs: 20, fat: 50 },
      { name: "ì•„ëª¬ë“œë²„í„°", protein: 20, carbs: 20, fat: 55 },
      { name: "ê²¬ê³¼ë¥˜",    protein: 15, carbs: 15, fat: 50 },
      { name: "ì•„ë³´ì¹´ë„",  protein: 2,  carbs: 8,  fat: 15 }
    ];

    // (A-1) ì „ì²´ ì‹í’ˆ ì´ë¦„ ë¦¬ìŠ¤íŠ¸ (ì˜µì…˜ ì±„ìš°ê¸°ìš©)
    const ALL_FOODS = [
      ...PROTEIN_SOURCES.map(item => item.name),
      ...CARB_SOURCES.map(item => item.name),
      ...FAT_SOURCES.map(item => item.name),
    ];

    // (A-2) onload ì‹œì ì— ì œì™¸í•  ì‹í’ˆ ì˜µì…˜ ì±„ìš°ê¸°
    window.addEventListener("DOMContentLoaded", () => {
      const excludedSelect = document.getElementById("excludedFoods");
      ALL_FOODS.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        excludedSelect.appendChild(opt);
      });
    });

    // (B) ë¬´ì‘ìœ„ ì•„ì´í…œ ì„ íƒ + ì œì™¸ ì‹í’ˆ ë°˜ì˜
    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function filterExcluded(arr, excludedArr) {
      // arr: ì›ë³¸ ì‹í’ˆ ë°°ì—´, excludedArr: ì œì™¸í•  ì‹í’ˆ ì´ë¦„ ë°°ì—´
      return arr.filter(item => !excludedArr.includes(item.name));
    }

    // (C) ë©”ì¸ ê³„ì‚° í•¨ìˆ˜
    function calculate() {
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);
      const height = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const activity = parseFloat(document.getElementById("activity").value);
      const goal = document.getElementById("goal").value;

      // ì œì™¸ ì‹í’ˆ
      const excludedFoodsSelect = document.getElementById("excludedFoods");
      // selectedOptionsëŠ” ìœ ì‚¬ ë°°ì—´ â†’ Array.fromìœ¼ë¡œ ì²˜ë¦¬
      const excludedFoodsArr = Array.from(excludedFoodsSelect.selectedOptions).map(opt => opt.value);

      if (!age || !height || !weight) {
        alert("ë‚˜ì´, í‚¤, ì²´ì¤‘ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // (1) BMR
      let bmr;
      if (gender === "male") {
        bmr = 66 + (13.7 * weight) + (5 * height) - (6.8 * age);
      } else {
        bmr = 655 + (9.6 * weight) + (1.8 * height) - (4.7 * age);
      }

      // (2) í™œë™ì§€ìˆ˜
      const rawTdee = bmr * activity;
      // (3) í•œêµ­ì¸ 15% ì°¨ê°
      const tdee = rawTdee * 0.85;
      // (4) ëª©ì  Â±10%
      let targetCal;
      if (goal === "gain") {
        targetCal = tdee * 1.1; // ì¦ëŸ‰
      } else {
        targetCal = tdee * 0.9; // ê°ëŸ‰
      }

      // (5) ë§¤í¬ë¡œ ë¹„ìœ¨
      const proteinRatio = 0.3;
      const carbRatio    = 0.5;
      const fatRatio     = 0.2;

      let totalProtein = (targetCal * proteinRatio) / 4;
      let totalCarbs   = (targetCal * carbRatio) / 4;
      let totalFats    = (targetCal * fatRatio) / 9;

      // ë‹¨ë°±ì§ˆ ë³´ì¶©ì œ 30g ì„ ì„­ì·¨
      totalProtein -= 30;
      if (totalProtein < 0) totalProtein = 0;

      // í•˜ë£¨ 3ë¼ ê¸°ì¤€
      const mealProtein = (totalProtein / 3).toFixed(1);
      const mealCarbs   = (totalCarbs   / 3).toFixed(1);
      const mealFats    = (totalFats    / 3).toFixed(1);

      // (9) ê²°ê³¼ ìš”ì•½
      let html = `
        <h2>ğŸ“Š ê²°ê³¼ ìš”ì•½</h2>
        <p><b>í•˜ë£¨ ê¸°ì´ˆ ì†Œë¹„ ì¹¼ë¡œë¦¬:</b> ${bmr.toFixed(0)} kcal</p>
        <p><b>ìœ ì§€ ì¹¼ë¡œë¦¬:</b> ì•½ ${rawTdee.toFixed(0)} kcal</p>
        <p><b>í•œêµ­ì¸ ê¸°ì¤€(15%â†“):</b> ì•½ ${tdee.toFixed(0)} kcal</p>
        <p><b>ëª©í‘œ ì„­ì·¨ ì¹¼ë¡œë¦¬ (${goal === "gain" ? "ì¦ëŸ‰" : "ê°ëŸ‰"}):</b> ${targetCal.toFixed(0)} kcal</p>

        <h3>ğŸ½ í•˜ë£¨ 3ë¼ ê¶Œì¥ ì„­ì·¨ëŸ‰</h3>
        <p>ê°„ì‹ìœ¼ë¡œ ë‹¨ë°±ì§ˆ ë³´ì¶©ì œ(1ìŠ¤ì¿± - ë‹¨ë°±ì§ˆ 30g) ì„­ì·¨ ê°€ì •</p>
      `;

      // ë§¤í¬ë¡œ í•˜ì´ë¼ì´íŠ¸
      const macroHTML = `
        <div class="macro-highlight">
          <span>ë‹¨ë°±ì§ˆ: ${mealProtein}g</span>
          <span>íƒ„ìˆ˜í™”ë¬¼: ${mealCarbs}g</span>
          <span>ì§€ë°©: ${mealFats}g</span>
        </div>
      `;
      html += macroHTML;

      // (B-1) ì œì™¸ ì‹í’ˆ ì ìš©í•œ ë°°ì—´ ì¤€ë¹„
      const proteinArr = filterExcluded(PROTEIN_SOURCES, excludedFoodsArr);
      const carbArr    = filterExcluded(CARB_SOURCES, excludedFoodsArr);
      const fatArr     = filterExcluded(FAT_SOURCES, excludedFoodsArr);

      // (NEW) í•˜ë£¨ 3ë¼ ì‹ë‹¨ êµ¬ì„±
      // ê° ë¼ë‹ˆë§ˆë‹¤ ë¬´ì‘ìœ„ ë‹¨/íƒ„/ì§€ ì‹í’ˆ 1ê°œì”© ì„ íƒ â†’ ì„­ì·¨ëŸ‰(g) ê³„ì‚°
      // ë‹¨ìˆœí™”: (mealProtein / proteinItem.protein) * 100 etc.
      let mealBlocks = ""; // 3ë¼ HTML ëˆ„ì 

      for (let i = 1; i <= 3; i++) {
        // ë¼ë‹ˆë³„ ë¬´ì‘ìœ„ ì„ íƒ
        let pItem = pickRandom(proteinArr);
        let cItem = pickRandom(carbArr);
        let fItem = pickRandom(fatArr);

        if (!pItem || !cItem || !fItem) {
          // ë§Œì•½ ì œì™¸ ì‹í’ˆì´ ë„ˆë¬´ ë§ì•„ ëœë¤ ì„ íƒ ë¶ˆê°€ ì‹œ
          mealBlocks += `
            <div class="meal-block">
              <h4>ğŸ½ ë¼ë‹ˆ #${i}</h4>
              <p style="color:red;">(ì„ íƒí•  ì‹í’ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì œì™¸ ì‹í’ˆì„ ì¤„ì´ê±°ë‚˜ DBë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”.)</p>
            </div>
          `;
          continue;
        }

        // ë¼ë‹ˆë‹¹ ì‹í’ˆ ì„­ì·¨ëŸ‰
        let pAmt = (parseFloat(mealProtein) / pItem.protein) * 100;
        let cAmt = (parseFloat(mealCarbs)   / cItem.carbs)    * 100;
        let fAmt = (parseFloat(mealFats)    / fItem.fat)      * 100;

        mealBlocks += `
          <div class="meal-block">
            <h4>ğŸ½ ë¼ë‹ˆ #${i} (ë¬´ì‘ìœ„ ì˜ˆì‹œ)</h4>
            <p><b>ë‹¨ë°±ì§ˆ ì‹í’ˆ:</b> ${pItem.name} ì•½ <b>${pAmt.toFixed(0)}g</b></p>
            <p><b>íƒ„ìˆ˜í™”ë¬¼ ì‹í’ˆ:</b> ${cItem.name} ì•½ <b>${cAmt.toFixed(0)}g</b></p>
            <p><b>ì§€ë°© ì‹í’ˆ:</b> ${fItem.name} ì•½ <b>${fAmt.toFixed(0)}g</b></p>
          </div>
        `;
      }

      // ìƒì„¸ ì‹ì¬ë£Œ ëª©ë¡
      const detailHtml = `
        <div class="spacer"></div>
        <h3>ğŸ¥© ë‹¨ë°±ì§ˆ ê¸‰ì›</h3>
        <ul>
          ${PROTEIN_SOURCES.map(item => `
            <li>${item.name} (100g): ë‹¨ ${item.protein}g / íƒ„ ${item.carbs}g / ì§€ ${item.fat}g</li>
          `).join("")}
        </ul>

        <h3>ğŸš íƒ„ìˆ˜í™”ë¬¼ ê¸‰ì›</h3>
        <ul>
          ${CARB_SOURCES.map(item => `
            <li>${item.name} (100g): ë‹¨ ${item.protein}g / íƒ„ ${item.carbs}g / ì§€ ${item.fat}g</li>
          `).join("")}
        </ul>

        <h3>ğŸ¥‘ ì§€ë°© ê¸‰ì›</h3>
        <ul>
          ${FAT_SOURCES.map(item => `
            <li>${item.name} (100g): ë‹¨ ${item.protein}g / íƒ„ ${item.carbs}g / ì§€ ${item.fat}g</li>
          `).join("")}
        </ul>
      `;

      document.getElementById("result").innerHTML = html + mealBlocks + detailHtml;
    }
  </script>
</body>
</html>
